# PowerDNS systemd service overrides
# Generated by Ansible

[Unit]
Description=PowerDNS Authoritative Server
Documentation=man:pdns_server(1) man:pdns_control(1)
Documentation=https://doc.powerdns.com
After=network.target mysql.service mariadb.service
Wants=network.target
Requires=mysql.service

[Service]
# Security settings
NoNewPrivileges=true
ProtectSystem=strict
ProtectHome=true
ReadWritePaths={{ powerdns_config_dir }} /var/lib/powerdns /var/log /tmp
PrivateTmp=true
ProtectKernelTunables=true
ProtectKernelModules=true
ProtectControlGroups=true
RestrictRealtime=true
RestrictSUIDSGID=true
LockPersonality=true
RestrictNamespaces=true
SystemCallFilter=@system-service
SystemCallErrorNumber=EPERM

# Resource limits
LimitNOFILE={{ system_tuning.file_descriptors | default(65536) }}
LimitNPROC=32768

# Memory settings
{% if not system_tuning.core_dump | default(false) %}
LimitCORE=0
{% endif %}

# Restart policy
Restart=always
RestartSec=5
StartLimitInterval=0

# Environment
Environment=PDNS_CONFIG_DIR={{ powerdns_config_dir }}

[Install]
WantedBy=multi-user.target
