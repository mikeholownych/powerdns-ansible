# Fail2ban filter for PowerDNS
# Generated by Ansible on {{ ansible_date_time.iso8601 }}

[Definition]

# Fail2ban filter to match PowerDNS abuse patterns

# Match failed DNS queries and potential abuse
failregex = ^.*\[.*\] .*: query from <HOST>.*: query refused.*$
            ^.*\[.*\] .*: client <HOST>.*: query \(.*\) denied.*$
            ^.*\[.*\] .*: rate limit exceeded for <HOST>.*$
            ^.*\[.*\] .*: too many queries from <HOST>.*$
            ^.*\[.*\] .*: abuse detected from <HOST>.*$
            ^.*\[.*\] .*: suspicious query pattern from <HOST>.*$

# Ignore legitimate queries
ignoreregex = ^.*\[.*\] .*: query from <HOST>.*: query allowed.*$
              ^.*\[.*\] .*: client <HOST>.*: query \(.*\) approved.*$

# Date pattern for PowerDNS logs
datepattern = ^%%Y-%%m-%%d %%H:%%M:%%S
