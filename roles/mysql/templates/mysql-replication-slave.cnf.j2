# MySQL/MariaDB Slave Replication Configuration
# Generated by Ansible on {{ ansible_date_time.iso8601 }}

[mysqld]
# Server identification
server-id = {{ server_id | default(2) }}

# Read-only mode (will be managed by keepalived/failover scripts)
read_only = ON

# Relay log settings
relay-log = relay-bin
relay-log-index = relay-bin.index
relay_log_recovery = ON

# Binary logging (for cascading replication)
log-bin = mysql-bin
log-bin-index = mysql-bin.index
binlog_format = ROW

# GTID settings (for MySQL 5.6+)
gtid_mode = ON
enforce_gtid_consistency = ON
log_slave_updates = ON

# Slave settings
slave_skip_errors = 1062,1032
slave_net_timeout = 60
slave_compressed_protocol = ON

# Performance settings
sync_binlog = 1
innodb_flush_log_at_trx_commit = 1

# Network settings
bind-address = {{ ansible_default_ipv4.address }}

# Replication filters
replicate_do_db = {{ powerdns_db_name }}

# Crash-safe replication
master_info_repository = TABLE
relay_log_info_repository = TABLE
