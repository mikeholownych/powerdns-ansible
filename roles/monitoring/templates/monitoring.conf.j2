# PowerDNS Monitoring Configuration
# Generated by Ansible on {{ ansible_date_time.iso8601 }}

[general]
enabled={{ monitoring_config.enabled | default(true) | lower }}
log_level=INFO
log_directory=/var/log/monitoring
alert_email={{ alert_email | default('') }}
alert_webhook={{ alert_webhook_url | default('') }}

[thresholds]
cpu_usage_percent={{ monitoring_config.alert_thresholds.cpu_usage_percent | default(80) }}
memory_usage_percent={{ monitoring_config.alert_thresholds.memory_usage_percent | default(80) }}
disk_usage_percent=90
response_time_ms={{ monitoring_config.alert_thresholds.response_time_ms | default(100) }}
error_rate_percent={{ monitoring_config.alert_thresholds.error_rate_percent | default(5) }}

[intervals]
health_check={{ monitoring_config.health_check_interval | default(300) }}
system_monitor=600
dns_monitor=120
performance_check=3600

[powerdns]
service_name={{ powerdns_service_name }}
config_file={{ powerdns_config_file }}
api_enabled={{ powerdns_api_readonly is defined | lower }}
{% if powerdns_api_readonly is defined %}
api_port={{ powerdns_webserver_port | default(8081) }}
api_key={{ powerdns_api_key }}
{% endif %}

[database]
host={{ powerdns_db_host }}
port={{ powerdns_db_port }}
name={{ powerdns_db_name }}
user={{ powerdns_db_user }}

[domains]
{% for domain in primary_domains %}
primary_domain_{{ loop.index }}={{ domain }}
{% endfor %}

{% if reverse_zones is defined %}
{% for zone in reverse_zones %}
reverse_zone_{{ loop.index }}={{ zone }}
{% endfor %}
{% endif %}

[servers]
primary_server={{ ansible_default_ipv4.address }}
{% if groups['powerdns_secondary'] is defined %}
{% for host in groups['powerdns_secondary'] %}
secondary_server_{{ loop.index }}={{ hostvars[host]['ansible_default_ipv4']['address'] }}
{% endfor %}
{% endif %}

[prometheus]
{% if monitoring_config.prometheus_port is defined %}
enabled=true
port={{ monitoring_config.prometheus_port }}
metrics_path=/metrics
{% else %}
enabled=false
{% endif %}
